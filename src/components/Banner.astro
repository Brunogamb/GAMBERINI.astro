---
import sistemaIncendiosImg from '../assets/banner/sistema-incendios.webp';
import diseñoMontajeImg from '../assets/banner/diseño-montaje.webp';
import servicioTecnicoImg from '../assets/banner/servicio-tecnico.webp';

const slides = [
    {
        href: "/sistema-de-protección-contra-incendios",
        image: sistemaIncendiosImg,
        alt: "Vista de una sala de bombas para sistema de protección contra incendios",
        title: "Sistema de Protección Contra Incendios",
        description: "Diseño, instalación y mantenimiento de sistemas contra incendios segun normas IRAM y NFPA"
    },
    {
        href: "/diseño-y-montaje",
        image: diseñoMontajeImg,
        alt: "Equipo trabajando en el diseño y montaje de una instalación",
        title: "Diseño y Montaje",
        description: "Servicios integrales para el diseño y montaje de sistemas de bombeo a sus necesidades específicas."
    },
    {
        href: "/servicio-tecnico",
        image: servicioTecnicoImg,
        alt: "Técnico realizando mantenimiento a un equipo de bombeo",
        title: "Servicio Técnico Autorizado",
        description: "Mantenimiento, reparación y soporte técnico para asegurar el óptimo funcionamiento de sus equipos de bombeo."
    }
];
---

<div class="banner-carousel">
  <div class="carousel-track" id="banner-track">
    {slides.map((slide) => (
      <a href={slide.href} class="carousel-slide" aria-label={`Ir a ${slide.alt}`}
        style={{ backgroundImage: `url(${slide.image.src})` }}>
        <div class="banner-text">
          <h2>{slide.title}</h2>
          <p>{slide.description}</p>
        </div>
      </a>
    ))}
  </div>

  <div class="carousel-controls">
    <button id="prev" aria-label="Diapositiva anterior">&#10094;</button>
    <button id="next" aria-label="Siguiente diapositiva">&#10095;</button>
  </div>

  <div class="progress-bars" id="progress-bars">
    {slides.map((_, i) => (
      <div class="progress-bar"><div class="progress-fill" data-index={i}></div></div>
    ))}
  </div>
</div>

<style>
.banner-carousel {
  position: relative;
  height: calc(100dvh - 128px);
  overflow: hidden;
}

.carousel-track {
  display: flex;
  height: 100%;
  transition: transform 0.4s ease-in-out;
}

.carousel-slide {
  flex: 0 0 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-size: cover;
  background-position: center;
  color: var(--white);
}

.banner-text {
  background: linear-gradient(90deg, rgba(var(--brand-900-rgb),0.88) 20%, rgba(var(--brand-800-rgb),0.88) 45%, rgba(var(--brand-700-rgb),0.88) 75%);
  padding: 2rem;
  border-radius: var(--radius-md);
  max-width: 700px;
  backdrop-filter: blur(var(--blur-sm));
  word-break: break-word;
  text-wrap: balance;
}

.banner-text h2 {
  font-size: 38px;
  font-weight: 700;
  margin-bottom: 18px;
  line-height: 1.1;
}

.banner-text p {
  font-size: 20px;
  font-weight: 200;
  line-height: 1.5;
  color: var(--muted);
}

.carousel-controls {
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 1rem;
  transform: translateY(-50%);
  z-index: 20;
  opacity: 1;
  pointer-events: none;
}

.carousel-controls button {
  pointer-events: auto;
}

.carousel-controls button {
  background: rgba(20, 20, 30, 0.55); 
  border: none; 
  color: var(--white);
  width: 44px;
  height: 44px;
  font-size: 22px;
  cursor: pointer;
  border-radius: var(--radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(var(--blur-sm));
  transition: background 0.2s, transform 0.2s;
  box-shadow: var(--shadow-lg);
  opacity: 0.85;
  pointer-events: auto;
  position: relative;
}

.carousel-controls button:hover {
  background: rgba(30, 30, 30, 0.85);
  border: 2px solid var(--white);
  transform: scale(1.12);
  opacity: 1;
}

.progress-bars {
  position: absolute;
  bottom: 14px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  width: 80%;
  max-width: 280px;
  z-index: 15;
}

.progress-bar {
  flex: 1;
  height: 4px;
  background: rgba(255,255,255,0.35);
  border-radius: 2px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: var(--white);
  border-radius: 2px;
}

@media (max-width: 736px) {
  .banner-carousel {
    height: calc(100dvh - 80px);
  }

  .carousel-controls {
    top: auto;
    bottom: 18px;
  }

  .carousel-controls button {
    width: 40px;
    height: 40px;
    font-size: 20px;
  }

  .banner-text {
    margin: 32px 8px 64px 8px;
  }
}
</style>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {
  const track = document.getElementById("banner-track");
  const slides = track.querySelectorAll(".carousel-slide");
  const total = slides.length;
  const fills = document.querySelectorAll(".progress-fill");

  let index = 0;
  let autoplayInterval;
  const duration = 7000; 

  function updateSlide() {
    track.style.transform = `translateX(-${index * 100}%)`;
    resetProgress();
  }

  function startAutoplay() {
    autoplayInterval = setInterval(() => {
      index = (index + 1) % total;
      updateSlide();
    }, duration);
    resetProgress();
  }

  function stopAutoplay() {
    clearInterval(autoplayInterval);
  }

  function resetProgress() {
    fills.forEach((fill, i) => {
      fill.style.width = "0%";
      fill.style.transition = "none";
    });
    void document.body.offsetWidth;

    fills.forEach((fill, i) => {
      if (i === index) {
        fill.style.transition = `width ${duration}ms linear`;
        fill.style.width = "100%";
      }
    });
  }

  document.getElementById("next").addEventListener("click", () => {
    index = (index + 1) % total;
    updateSlide();
  });

  document.getElementById("prev").addEventListener("click", () => {
    index = (index - 1 + total) % total;
    updateSlide();
  });

  let startX = 0;
  let isSwiping = false;

  track.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
    isSwiping = true;
    stopAutoplay();
  });

  track.addEventListener("touchend", (e) => {
    if (!isSwiping) return;
    const endX = e.changedTouches[0].clientX;
    const diffX = startX - endX;

    if (Math.abs(diffX) > 50) {
      if (diffX > 0) {
        index = (index + 1) % total;
      } else {
        index = (index - 1 + total) % total;
      }
      updateSlide();
    }

    isSwiping = false;
    startAutoplay();
  });

  updateSlide();
  startAutoplay();
});
</script>