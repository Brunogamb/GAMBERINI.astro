---
import { Image } from 'astro:assets';

import sistemaIncendiosImg from '../assets/img/sistema-incendios.webp';
import disenoMontajeImg from '../assets/img/bomba1.png';
import servicioTecnicoImg from '../assets/img/servicio-tecnico.webp';

const slides = [
    {
        href: "/GAMBERINI.astro/sistema-de-protección-contra-incendios",
        image: sistemaIncendiosImg,
        alt: "Vista de una sala de bombas para sistema de protección contra incendios",
        title: "Sistema de Protección Contra Incendios",
        description: "Diseño, instalación y mantenimiento de sistemas contra incendios segun normas IRAM y NFPA"
    },
    {
        href: "/GAMBERINI.astro/diseño-y-montaje",
        image: disenoMontajeImg,
        alt: "Equipo trabajando en el diseño y montaje de una instalación",
        title: "Diseño y Montaje",
        description: "Servicios integrales para el diseño y montaje de sistemas de bombeo a sus necesidades específicas."
    },
    {
        href: "/GAMBERINI.astro/servicio-tecnico",
        image: servicioTecnicoImg,
        alt: "Técnico realizando mantenimiento a un equipo de bombeo",
        title: "Servicio Técnico Autorizado",
        description: "Mantenimiento, reparación y soporte técnico para asegurar el óptimo funcionamiento de sus equipos de bombeo."
    }
];
---

<div class="banner-carousel">
  <div class="carousel-track" id="banner-track">
    {slides.map((slide) => (
      <a href={slide.href} class="carousel-slide" aria-label={`Ir a ${slide.alt}`}
        style={{ backgroundImage: `url(${slide.image.src})` }}>
        <div class="banner-text">
          <div class="title-divider"></div>
          <h2>{slide.title}</h2>
          <p>{slide.description}</p>
        </div>
      </a>
    ))}
  </div>
  <div class="carousel-controls">
    <button id="prev" aria-label="Diapositiva anterior">&#10094;</button>
    <button id="next" aria-label="Siguiente diapositiva">&#10095;</button>
  </div>
  <div class="carousel-dots" id="carousel-dots">
    {slides.map((_, i) => (
      <button class="dot" aria-label={`Ir a la diapositiva ${i + 1}`} data-index={i}></button>
    ))}
  </div>
</div>

<style>
.banner-carousel {
  position: relative;
  height: calc(100dvh - 128px);
}

.carousel-track {
  display: flex;
  height: 100%;
  transition: transform 0.4s ease-in-out;
}

.carousel-slide {
  flex: 0 0 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-size: cover;
  background-position: center;
  color: #fff;
}

.banner-text {
  background: linear-gradient(90deg, #29166fe1 20%, #3a2a8fe1 45%, #5145b6e1 75%);
  padding: 2rem;
  border-radius: 16px;
  max-width: 700px;
  backdrop-filter: blur(6px);
}

.banner-text h2 {
  font-size: 38px;
  font-weight: 700;
  margin-bottom: 18px;
  line-height: 1.1;
}

.banner-text p {
  font-size: 20px;
  font-weight: 200;
  line-height: 1.5;
  color: #e4e0fa;
}

.carousel-controls {
  position: absolute;
  top: 50%;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 1rem;
  transform: translateY(-50%);
  z-index: 10;
  pointer-events: none;
}

.carousel-controls button {
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #fff;
  width: 60px;
  height: 60px;
  font-size: 30px;
  cursor: pointer;
  border-radius: 50%;
  pointer-events: auto;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(6px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

.carousel-controls button:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: scale(1.1);
}

.carousel-dots {
  position: absolute;
  bottom: 15px;
  width: 100%;
  text-align: center;
  z-index: 15;
}

.carousel-dots .dot {
  cursor: pointer;
  height: 14px;
  width: 14px;
  margin: 0 6px;
  background-color: rgba(255,255,255,0.5);
  border-radius: 50%;
  display: inline-block;
  border: none;
  transition: all 0.3s ease;
  backdrop-filter: blur(6px);
}

.carousel-dots .dot:hover {
  background-color: rgba(255,255,255,0.8);
  transform: scale(1.1);
}

.carousel-dots .dot.active {
  background-color: #fff;
}

@media (max-width: 780px) {
  .banner-carousel {
    overflow: hidden;
  }
  .banner-text {
    max-width: 90%;
  }
}
</style>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {
  const track = document.getElementById("banner-track");
  const slides = track.querySelectorAll(".carousel-slide");
  const dots = document.querySelectorAll(".carousel-dots .dot");
  const total = slides.length;
  let index = 0;
  let autoplayInterval;

  function updateSlide() {
    track.style.transform = `translateX(-${index * 100}%)`;
    dots.forEach(dot => dot.classList.remove("active"));
    dots[index].classList.add("active");
  }

  function startAutoplay() {
    autoplayInterval = setInterval(() => {
      index = (index + 1) % total;
      updateSlide();
    }, 7000);
  }

  function stopAutoplay() {
    clearInterval(autoplayInterval);
  }

  document.getElementById("next").addEventListener("click", () => {
    index = (index + 1) % total;
    updateSlide();
  });

  document.getElementById("prev").addEventListener("click", () => {
    index = (index - 1 + total) % total;
    updateSlide();
  });

  dots.forEach(dot => {
    dot.addEventListener("click", (e) => {
      index = Number(e.target.dataset.index);
      updateSlide();
    });
  });

  let startX = 0;
  let isSwiping = false;

  track.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
    isSwiping = true;
    stopAutoplay();
  });

  track.addEventListener("touchend", (e) => {
    if (!isSwiping) return;

    const endX = e.changedTouches[0].clientX;
    const diffX = startX - endX;

    if (Math.abs(diffX) > 50) {
      if (diffX > 0) {
        index = (index + 1) % total;
      } else {
        index = (index - 1 + total) % total;
      }
      updateSlide();
    }

    isSwiping = false;
    startAutoplay();
  });

  updateSlide();
  startAutoplay();
});
</script>